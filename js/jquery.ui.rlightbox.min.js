(function($,undefined){$.widget("ui.rlightbox",{options:{animationSpeed:"fast",setPrefix:"lb",showMap:true,counterDelimiter:" / ",videoWidth:640,videoHeight:385,errorMessage:"Oh dear! Something went wrong! If the problem still appears let the page’s admin know. Would you like to try again or reject the content?",againButtonLabel:"Try again",rejectButtonLabel:"Reject this content",overwriteTitle:false,keys: {next:[78,39],previous:[80,37],close:[67,27],panorama:[90,null]},loop:false},_create:function(){var _setElement,global=$.ui.rlightbox.global,self=this;global.getLightbox();_setElement=global.extractAnchor(this);if(_setElement.type!==undefined) {global.addToSet(_setElement);this.element.click(function(event){global.open(self);event.preventDefault();});}},_setOption:function(key,value){}});$.extend($.ui.rlightbox,{global:{addToSet:function(setElement){var _setName=this.getSetName(setElement.self),_sets=$.ui.rlightbox.global.sets,_options=setElement.self.options,_setPrefix=_options.setPrefix,_class="."+_setPrefix+"_"+ _setName,_setElementIndex=$(_class).index(setElement.element);if(!_sets[_setName]){_sets[_setName]=[];_sets[_setName].push(setElement);}else{_sets[_setName].splice(_setElementIndex,0,setElement);}},checkButtonsState:function() {var data=this.data,$lb=this.$lightbox,_currentSet=data.currentSet,_totalElements=data.totalElementsNumber,_currentElement=data.currentElementNumber,_isLoop=data.currentSetElement.self.options.loop;if( _currentSet==="single"||_totalElements===1) {this.setButtonState("disabled");}else if(_currentElement===1&&_isLoop===false){this.setButtonState( "disabled",$lb.prev);this.setButtonState( "default",$lb.next);}else if(_currentElement===_totalElements&&_isLoop===false) {this.setButtonState( "disabled",$lb.next);this.setButtonState( "default",$lb.prev);}else{this.setButtonState( "default");}},checkMinimalSize:function(size,number) {var data=this.data,_minimalLightboxSize=data.minimalLightboxSize,_minimalLightboxWidth=_minimalLightboxSize.width,_minimalLightboxHeight=_minimalLightboxSize.height;if(size==="width" ) {if(number<_minimalLightboxWidth){return _minimalLightboxWidth;}else{return number;}}else if(size==="height" ) {if(number<_minimalLightboxHeight){return _minimalLightboxHeight;}else{return number;}}},closeLightbox:function() {var data=this.data,$lb=this.$lightbox;if(data.ready){$lb.overlay.add($lb.root).add($lb.header).hide();$("body").css("overflow","visible");$lb.content.empty().width(20).height(20);this.hideArrow();this.setButtonState("default" );this.panoramaHideIcon();data.currentElementNumber=null;data.totalElementsNumber=null;$lb.title.empty();this.panoramaHideMap();data.ready=false;}},createStructure:function(){var data=this.data;$(data.htmlLightbox).appendTo("body").after(data.htmlMap).after(data.htmlOverlay);},destroy:function() {var data=this.data,$currentElement=data.currentSetElement.element;$currentElement.unbind("."+"rlightbox").unbind( "click" ).removeData("rlightbox");},extractAnchor:function(thisElement){var _result={type:undefined},$anchor=$(thisElement.element),_url=$anchor.attr( "href"),_service={youtube:{urls:[/(http:\/\/www\.youtube\.com\/watch\?v=([\w-_]+))&?/],type:"youtube"},image:{urls:[/.jpg$|.png$|.gif$/],type:"image"},vimeo:{urls:[/(http:\/\/vimeo\.com\/groups\/\w+\/videos\/(\w+))&?/,/(http:\/\/vimeo\.com\/(\w+))&?/],type:"vimeo"},flash:{urls:[/.swf/],type:"flash"}};$.each(_service,function(name,content) {var _found=false;$.each(content.urls,function(index,regExp){var _res=regExp.exec( _url );if(_res!==null){_result={url:_res[1],id:_res[2],type:content.type,element:$anchor,self:thisElement};if(content.type==="image"||content.type==="flash"||thisElement.options.overwriteTitle) {_result.title=$anchor.attr( "title" );_result.url=_url;}
_found=true;return false;}});if( _found) {return false;}});return _result;},getAvailableScreenSize:function(){var data=this.data,_padding=data.lightboxPadding;return{width:this.getWindowSize( "width" )-_padding,height:this.getWindowSize( "height" )-data.headerHeight-_padding};},getCurrentElementNumber:function(element){var _currentNumber,data=this.data,sets=this.sets,self=this,_currentSet=sets[data.currentSet];$.each(_currentSet,function(i,v){if($(element).get(0)===v.element.get(0)){_currentNumber=i+1;return false;}});return _currentNumber;},getImageStatus:function(width,height){var _statusWidth,_statusHeight,data=this.data,_currentElement=data.currentSetElement,_windowWidth=this.getWindowSize( "width" ),_windowHeight=this.getWindowSize( "height"),_minimalLightboxWidth=data.minimalLightboxSize.width,_minimalLightboxHeight=data.minimalLightboxSize.height,_imageWidth=_currentElement.width,_imageHeight=_currentElement.height,_lightboxPadding=data.lightboxPadding,_headerHeight=data.headerHeight;if(width<=_minimalLightboxWidth){_statusWidth=-1;}else if(width>_minimalLightboxWidth&&width+_lightboxPadding<=_windowWidth){_statusWidth=1;}else{_statusWidth=2;}
if(height<=_minimalLightboxHeight){_statusHeight=-1;}else if(height>_minimalLightboxHeight&&_windowHeight>=height+_lightboxPadding+_headerHeight){_statusHeight=1;}else{_statusHeight=2;}
return{statusWidth:_statusWidth,statusHeight:_statusHeight};},getLightbox:function() {var data=this.data,$lb=this.$lightbox,self=this;if(!$lb.root) {this.createStructure();this.setReferences();$lb.close.add($lb.overlay).click($.proxy(this.closeLightbox,this) );$lb.next.click($.proxy(this.next,this) );$lb.prev.click($.proxy(this.prev,this) );$lb.next.add($lb.prev).add($lb.next).add($lb.close).hover(function() {if($(this).is(":not(.ui-state-disabled)") ){self.setButtonState("highlight",$(this));}},function() {if($(this).is(":not(.ui-state-disabled)")) {self.setButtonState( "default",$(this));}});$lb.contentContainer.mousemove($.proxy(this.showArrow,this) ).mousemove($.proxy(this.checkSide,this)).mousemove($.proxy(this.setCursor,this) ).click(function() {if(data.side ==="left") {self.prev.apply(self);}else if(data.side==="right"){self.next.apply(self);}}).mousedown($.proxy(this.panoramaStart,this) ).mouseup($.proxy(this.panoramaStop,this)).mouseleave(function() {self.hideArrow.apply(self);data.side="";});$lb.panoramaIcon.click($.proxy(this.panoramaToggle,this) ).hover($.proxy(this.panoramaHighlight,this) );$(window).bind("resize.rlightbox",$.proxy(this.liveResize,this) );$(document).keyup($.proxy(this.handleKeyboard,this) );}},getOptimalSize:function(size,number ) {var data=this.data,_minimalLightboxSize=data.minimalLightboxSize,_minimalLightboxWidth=_minimalLightboxSize.width,_minimalLightboxHeight=_minimalLightboxSize.height,_screenSize=this.getAvailableScreenSize(),_screenWidth=_screenSize.width,_screenHeight=_screenSize.height;if(size==="width" ) {if(number<_minimalLightboxWidth){return _minimalLightboxWidth;}else if(number>_screenWidth){return _screenWidth;}else{return number;}}else if(size==="height" ) {if(number<_minimalLightboxHeight){return _minimalLightboxHeight;}else if(number>_screenHeight ) {return _screenHeight;}else{return number;}}},getParam:function( param,url ) {var _result,_regExpString="[\\?&]"+param+"=(\\w+)",_regExp=new RegExp( _regExpString);_result=_regExp.exec(url );if( _result!==null) {return _result[1];}else{return null;}},getSetName:function(thisElement){var _classNames=$(thisElement.element).attr("class"),_classPrefix=thisElement.options.setPrefix+"_",_classPattern=new RegExp(_classPrefix+"([\\w-_]+)"),_name=_classPattern.exec(_classNames);return _name?_name[1]:"single";},checkSide:function(event) {var data=this.data,$lb=this.$lightbox,$container=$lb.contentContainer,_pos=event.pageX-$container.offset().left,_center=Math.round($container.width()/2),_currentElementNumber=data.currentElementNumber,_totalElementsNumber=data.totalElementsNumber;if(_pos<=_center){data.side="left";}else if(_pos>_center){data.side="right";}
event.preventDefault();},getSizes:function(){var _statuses,_statusWidth,_statusHeight,_imageTargetWidth,_imageTargetHeight,_lightboxTargetWidth,_lightboxTargetHeight,_heightRatio,_widthRatio,$lb=this.$lightbox,data=this.data,self=this,_currentElement=data.currentSetElement,_windowWidth=this.getWindowSize("width"),_windowHeight=this.getWindowSize( "height"),_minimalLightboxWidth=data.minimalLightboxSize.width,_minimalLightboxHeight=data.minimalLightboxSize.height,_imageWidth=_currentElement.width,_imageHeight=_currentElement.height,_lightboxPadding=data.lightboxPadding,_headerHeight=data.headerHeight;function _calculateSizes(w,h){_statuses=self.getImageStatus(w,h);_statusWidth=_statuses.statusWidth;_statusHeight=_statuses.statusHeight;if(((_statusWidth===1||_statusWidth===-1)&&_statusHeight!==2)&&((_statusHeight===1||_statusHeight===-1)&&_statusWidth!==2)){if(_statusWidth===1){_lightboxTargetWidth=w;}else if(_statusWidth===-1){_lightboxTargetWidth=_minimalLightboxWidth;}
_imageTargetWidth=w;if(_statusHeight===1){_lightboxTargetHeight=h;}else if(_statusHeight===-1){_lightboxTargetHeight=_minimalLightboxHeight;}
_imageTargetHeight=h;}else if(_statusWidth===2||_statusHeight===2){if(_statusWidth===1||_statusWidth===-1){_lightboxTargetHeight=_windowHeight-_headerHeight-_lightboxPadding;_imageTargetHeight=_lightboxTargetHeight;_heightRatio=_lightboxTargetHeight/h;if(_statusWidth===-1){_lightboxTargetWidth=_minimalLightboxWidth;_imageTargetWidth=Math.ceil(w*_heightRatio);}else{_lightboxTargetWidth=Math.ceil(w*_heightRatio)-_lightboxPadding;_imageTargetWidth=_lightboxTargetWidth;if(_imageTargetWidth<=_minimalLightboxWidth){_calculateSizes(_imageTargetWidth,_imageTargetHeight);}}}else if(_statusHeight===1||_statusHeight===-1){_lightboxTargetWidth=_windowWidth-_lightboxPadding;_imageTargetWidth=_lightboxTargetWidth;_widthRatio=_lightboxTargetWidth/w;if(_statusHeight===-1){_lightboxTargetHeight=_minimalLightboxHeight;_imageTargetHeight=Math.ceil(h*_widthRatio);}else{_lightboxTargetHeight=Math.ceil(h*_widthRatio)-_headerHeight-_lightboxPadding;_imageTargetHeight=_lightboxTargetHeight;if(_imageTargetHeight<=_minimalLightboxHeight){_calculateSizes(_imageTargetWidth,_imageTargetHeight);}}}else{if(w>h){_lightboxTargetWidth=_windowWidth-_lightboxPadding;_imageTargetWidth=_lightboxTargetWidth;_widthRatio=_lightboxTargetWidth/w;_lightboxTargetHeight=Math.ceil(h*_widthRatio)-_lightboxPadding-_headerHeight;_imageTargetHeight=_lightboxTargetHeight;if(_imageTargetHeight<=_minimalLightboxHeight||_lightboxTargetHeight+_lightboxPadding+ _headerHeight>_windowHeight){_calculateSizes(_imageTargetWidth,_imageTargetHeight);}}else{_lightboxTargetHeight=_windowHeight-_headerHeight-_lightboxPadding;_imageTargetHeight=_lightboxTargetHeight;_heightRatio=_lightboxTargetHeight/h;_lightboxTargetWidth=Math.ceil( w*_heightRatio)-_lightboxPadding;_imageTargetWidth=_lightboxTargetWidth;if(_imageTargetWidth<=_minimalLightboxWidth||_lightboxTargetWidth>_windowWidth){_calculateSizes(_imageTargetWidth,_imageTargetHeight);}}}}}
_calculateSizes(_imageWidth,_imageHeight);return{imageTargetWidth:_imageTargetWidth,imageTargetHeight:_imageTargetHeight,lightboxTargetWidth:_lightboxTargetWidth,lightboxTargetHeight:_lightboxTargetHeight,statusWidth:_statusWidth,statusHeight:_statusHeight};},getWindowSize:function(size ) {var data=this.data,_windowWidth=$(window).width(),_windowHeight=$(window ).height(),_minimalLightboxSize=data.minimalLightboxSize,_lightboxPadding=data.lightboxPadding,_headerHeight=data.headerHeight,_minimalLightboxWidth=_minimalLightboxSize.width+_lightboxPadding,_minimalLightboxHeight=_minimalLightboxSize.height+_lightboxPadding+_headerHeight;if(size=== "width" ) {if(_windowWidth <_minimalLightboxWidth){return _minimalLightboxWidth;}else{return _windowWidth;}}else{if(_windowHeight<_minimalLightboxHeight) {return _minimalLightboxHeight;}else{return _windowHeight;}}},handleKeyboard:function(event) {var data=this.data,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_keys=_options.keys,_key=event.which;if(data.ready===false){return;}
if(_key===_keys.next[0]||_key===_keys.next[1]){this.next();}else if(_key===_keys.previous[0]||_key===_keys.previous[1]){this.prev();}else if(_key===_keys.close[0]||_key===_keys.close[1]){this.closeLightbox();}else if((_key===_keys.panorama[0]||_key===_keys.panorama[1])&&_currentElement.type==="image"){this.panoramaToggle(event);}},hideArrow:function() {var $lb=this.$lightbox,$arrow=$lb.arrow;$arrow.hide();},liveResize:function(){var data=this.data,self=this,$lb=this.$lightbox,_elementType=data.currentSetElement.type;if(data.ready&&data.panoramaOn===false&&_elementType==="image"){this.queueResizeLightbox();this.updateTitleWidth();this.queueCenterContent();this.panoramaCheckAvailability();}else if(data.ready&&data.panoramaOn&&_elementType==="image"){this.queueCenterLightbox();this.panoramaShrink();this.panoramaCheckAvailability();}else if(data.ready&&_elementType!=="image" ) {this.queueCenterLightbox();}},loadContentFlash:function(url ) {var _width,_height,$contentWrapper,data=this.data,$lb=this.$lightbox,self=this,$content=$lb.content,_dfd=$.Deferred(),_structure=data.htmlFlash,_currentElement=data.currentSetElement,_options=_currentElement.self.options;$content.addClass("ui-lightbox-loader");function _load() {_width=self.getParam( "width",url );_height=self.getParam( "height",url );if(_width===null||isNaN(_width)) {_width=_options.videoWidth;}
if( _height===null||isNaN(_height)) {_height=_options.videoHeight;}
_currentElement.width=_width;_currentElement.height=_height;_structure=self.replaceHtmlPatterns(_structure,{width:_width,height:_height,url:url});$contentWrapper=$( "<div></div>" );$contentWrapper.css({display:"none",width:_width,height:_height});$content.removeClass( "ui-lightbox-loader").empty().append(_structure).children().wrap( $contentWrapper);_dfd.resolve();}
setTimeout(_load,1000);return _dfd.promise();},loadContentImage:function(url) {var $lb=this.$lightbox,data=this.data,self=this,_currentElement=data.currentSetElement,_dfd=$.Deferred(),$newImage=$( "<img />");$lb.content.addClass("ui-lightbox-loader");$newImage.attr( "src",url).bind("load",function() {$(this).unbind("load" );_currentElement.width=this.width;_currentElement.height=this.height;$lb.content.removeClass("ui-lightbox-loader").empty().append(this).children().hide();_dfd.resolve();}).error(function() {$lb.content.removeClass( "ui-lightbox-loader" );self.showErrorMessage();_dfd.resolve();}).each(function() {if(this.complete||this.complete===undefined){var src=this.src;this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";this.src=src;}});return _dfd.promise();},loadContentVimeo:function(url){var _width,_height,data=this.data,$lb=this.$lightbox,self=this,_dfd=$.Deferred(),_apiEnd=data.providers.vimeo,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_minimalLightboxSize=data.minimalLightboxSize;$lb.content.addClass( "ui-lightbox-loader" );$.ajax({url:_apiEnd,data:{url:url,maxwidth:_options.videoWidth,maxheight:_options.videoHeight},dataType:"jsonp",timeout:5000}).success(function(data){$lb.content.removeClass( "ui-lightbox-loader").empty().append(data.html).children().wrap( "<div style='display: none'></div>").end().find( "div:first" ).width(data.width).height(data.height);if(_options.overwriteTitle===false) {_currentElement.title=data.title;}
_currentElement.width=data.width;_currentElement.height=data.height;_dfd.resolve();}).error(function(){$lb.content.removeClass( "ui-lightbox-loader");self.showErrorMessage();_dfd.resolve();});return _dfd.promise();},loadContentYoutube:function(url){var $contentWrapper,data=this.data,$lb=this.$lightbox,$content=$lb.content,self=this,_dfd=$.Deferred(),_apiEnd=data.providers.youtube,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_minimalLightboxSize=data.minimalLightboxSize,_width=_options.videoWidth,_height=_options.videoHeight,_structure=data.htmlYoutube;function _showError() {$lb.content.removeClass( "ui-lightbox-loader");self.showErrorMessage();_dfd.resolve();}
$lb.content.addClass( "ui-lightbox-loader" );$.ajax({url:_apiEnd+_currentElement.id+"?callback=?",data:{v:2,alt:"jsonc",prettyprint:true},dataType:"jsonp",timeout:5000}).success(function(json){if(json.error) {_showError();return;}
_structure=self.replaceHtmlPatterns(_structure,{width:_width,height:_height,url:_currentElement.id});$contentWrapper=$( "<div></div>" );$contentWrapper.css({display:"none",width:_width,height:_height});$content.removeClass( "ui-lightbox-loader").empty().append(_structure).children().wrap( $contentWrapper);if(_options.overwriteTitle===false) {_currentElement.title=json.data.title;}
_currentElement.width=_width;_currentElement.height=_height;_dfd.resolve();}).error(function(){_showError();});return _dfd.promise();},navigationGoToElement:function(number) {var data=this.data,sets=this.sets,$lb=this.$lightbox,_currentSet=data.currentSet;data.currentElementNumber=number;data.currentSetElement=sets[_currentSet][number-1];this.setNextQueue();$lb.queueContainer.next.dequeue( "lightboxNext");},next:function() {var data=this.data,sets=this.sets,$lb=this.$lightbox,_isReady=data.ready,_isPanoramaOn=data.panoramaOn,_set=data.currentSet,_currentElementNumber=data.currentElementNumber,_totalElementsNumber=data.totalElementsNumber,_options=data.currentSetElement.self.options,_isLoop=_options.loop,_play=true;if(_isReady&&_set!=="single"&&_isPanoramaOn===false){if(_currentElementNumber+1<=_totalElementsNumber){data.currentElementNumber=_currentElementNumber=_currentElementNumber+1;}else if(_currentElementNumber+1>_totalElementsNumber&&_isLoop){data.currentElementNumber=_currentElementNumber=1;}else{_play=false;}
if( _play) {data.currentSetElement=sets[_set][_currentElementNumber-1];this.setNextQueue();$lb.queueContainer.next.dequeue("lightboxNext");}}},open:function(thisElement){var data=this.data,sets=this.sets,$lb=this.$lightbox,_jqElement=thisElement.element,_currentSet=this.getSetName(thisElement),_currentUrl=$(_jqElement).attr( "href");data.currentSet=_currentSet;data.totalElementsNumber=sets[_currentSet].length;data.currentElementNumber=this.getCurrentElementNumber(_jqElement);data.currentSetElement=sets[_currentSet][data.currentElementNumber-1];this.setOpenQueue();this.setNextQueue();this.checkButtonsState();$lb.queueContainer.open.dequeue("lightboxOpen");},panoramaCenterContent:function(){var _left,_top,data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_screenSize=this.getAvailableScreenSize(),_screenWidth=_screenSize.width,_screenHeight=_screenSize.height,_imageWidth=_currentElement.width,_imageHeight=_currentElement.height,$content=$lb.content,$img=$content.find("img");if(_screenWidth<_imageWidth){_left=0;}else{_left=$content.width()/2-$img.width()/2;}
if(_screenHeight<_imageHeight){_top=0;}else{_top=$content.height()/2-$img.height()/2;}
$img.css({top:_top,left:_left});},panoramaCheckAvailability:function() {var data=this.data,_currentElement=data.currentSetElement,_originalImageWidth=_currentElement.width,_originalImageHeight=_currentElement.height,_currentImageWidth=_currentElement.currentWidth,_currentImageHeight=_currentElement.currentHeight;if(_currentImageWidth<_originalImageWidth||_currentImageHeight<_originalImageHeight ) {this.panoramaShowIcon( "expand" );data.enablePanorama=true;}else{data.enablePanorama=false;this.panoramaHideIcon();}},panoramaExpand:function(event){var data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_options=_currentElement.self.options;data.panoramaOn=true;if(event.type==="click" ) {this.panoramaShowIcon("shrink","-hover");}else{this.panoramaShowIcon("shrink");}
$lb.content.css( "overflow","hidden");$lb.content.find("img").width(_currentElement.width).height(_currentElement.height);this.panoramaSetContentSize();this.panoramaCenterContent();this.queueCenterLightbox();this.updateTitleWidth();if(_options.showMap){this.panoramaShowMap();}
this.hideArrow();this.setCursor();},panoramaHideIcon:function() {var data=this.data,$lb=this.$lightbox;$lb.panoramaIcon.hide().removeClass("ui-lightbox-panorama-icon-expand ui-lightbox-panorama-icon-shrink");data.panoramaOn=false;},panoramaHideMap:function() {var $lb=this.$lightbox;$lb.map.hide();$lb.viewport.css({left:-1,top:-1});},panoramaHighlight:function() {var _suffixPosition,$lb=this.$lightbox,_suffix="-hover";$lb.panoramaIcon.attr("class",function(index,oldValue){_suffixPosition=oldValue.indexOf(_suffix );if(_suffixPosition!==-1 ){return oldValue.slice(0,_suffixPosition);}else{return oldValue+_suffix;}});},panoramaSetContentSize:function(){var _contentWidth,_contentHeight,data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_minLightboxSize=data.minimalLightboxSize,_minLightboxWidth=_minLightboxSize.width,_minLightboxHeight=_minLightboxSize.height,_screenSize=this.getAvailableScreenSize(),_screenWidth=_screenSize.width,_screenHeight=_screenSize.height,_imageWidth=_currentElement.width,_imageHeight=_currentElement.height;if(_imageWidth>_screenWidth){_contentWidth=_screenWidth;}else if(_imageWidth<=_minLightboxWidth){_contentWidth=_minLightboxWidth;}else{_contentWidth=_imageWidth;}
if(_imageHeight>_screenHeight){_contentHeight=_screenHeight;}else if(_imageHeight<=_minLightboxHeight){_contentHeight=_minLightboxHeight;}else{_contentHeight=_imageHeight;}
$lb.content.width(_contentWidth).height(_contentHeight);},panoramaShowIcon:function(icon,state) {var $lb=this.$lightbox,_state=state||"",_newClass="ui-lightbox-panorama-icon-"+icon+_state;$lb.panoramaIcon.show().removeClass().addClass(_newClass);},panoramaShowMap:function(){var _mapViewportWidth,_mapViewportHeight,_mapViewportWidthRatio,_mapViewportHeightRatio,_contentViewportWidth,_contentViewportHeight,data=this.data,_minimalLightboxSize=data.minimalLightboxSize,$lb=this.$lightbox,$content=$lb.content,$image=$content.find( "img" ),_imageWidth=$image.width(),_imageHeight=$image.height(),_currentElement=data.currentSetElement,_mapSize=data.mapSize;_mapViewportWidthRatio=_mapSize.width/_currentElement.width;_mapViewportHeightRatio=_mapSize.height/_currentElement.height;if(_imageWidth<_minimalLightboxSize.width){_contentViewportWidth=_imageWidth;}else{_contentViewportWidth=$content.width();}
if(_imageHeight<_minimalLightboxSize.height){_contentViewportHeight=_imageHeight;}else{_contentViewportHeight=$content.height();}
_mapViewportWidth=Math.ceil(_contentViewportWidth*_mapViewportWidthRatio);_mapViewportHeight=Math.ceil(_contentViewportHeight*_mapViewportHeightRatio);$lb.viewport.width(_mapViewportWidth).height(_mapViewportHeight);$lb.map.show();data.viewportRatio={width:_mapViewportWidthRatio,height:_mapViewportHeightRatio};},panoramaShrink:function(event){var data=this.data,$lb=this.$lightbox;data.panoramaOn=false;if(event &&event.type==="click" ) {this.panoramaShowIcon("expand","-hover" );}else{this.panoramaShowIcon("expand");}
this.queueResizeLightbox();this.queueCenterContent();$lb.content.css( "overflow","visible");this.updateTitleWidth();this.panoramaHideMap();this.setCursor();},panoramaStart:function(event){var data=this.data,$lb=this.$lightbox;data.panoramaPosition={xStart:event.pageX,yStart:event.pageY};event.preventDefault();},panoramaStop:function(event){var data=this.data,$lb=this.$lightbox,_distX=(event.pageX-data.panoramaPosition.xStart)*-1,_distY=(event.pageY-data.panoramaPosition.yStart)*-1,$content=$lb.content,_viewportRatio=data.viewportRatio;if(data.panoramaOn){$content.scrollLeft($content.scrollLeft()+_distX).scrollTop($content.scrollTop()+_distY);$lb.viewport.css({left:$content.scrollLeft()*_viewportRatio.width-1,top:$content.scrollTop()*_viewportRatio.height-1});}
event.stopPropagation();},panoramaToggle:function(event){var data=this.data,_panoramaOn=data.panoramaOn,_isPanoramaEnabled=data.enablePanorama;if(_isPanoramaEnabled&&_panoramaOn===false){this.panoramaExpand(event);}else if(_isPanoramaEnabled&&_panoramaOn){this.panoramaShrink(event);}},prev:function() {var data=this.data,sets=this.sets,$lb=this.$lightbox,_isReady=data.ready,_isPanoramaOn=data.panoramaOn,_set=data.currentSet,_currentElementNumber=data.currentElementNumber,_totalElementsNumber=data.totalElementsNumber,_options=data.currentSetElement.self.options,_isLoop=_options.loop,_play=true;if(_isReady&&_set!=="single"&&_isPanoramaOn===false){if(_currentElementNumber-1>=1){data.currentElementNumber=_currentElementNumber=_currentElementNumber-1;}else if(_currentElementNumber-1<1&&_isLoop){data.currentElementNumber=_currentElementNumber=_totalElementsNumber;}else{_play=false;}
if( _play ) {data.currentSetElement=sets[_set][_currentElementNumber-1];this.setNextQueue();$lb.queueContainer.next.dequeue("lightboxNext");}}},removeSetElement:function(number) {var data=this.data,sets=this.sets,_currentSet=data.currentSet,_total=data.totalElementsNumber;sets[_currentSet].splice(number-1,1);if(_total===1||_currentSet==="single") {this.closeLightbox();this.destroy();}else{this.destroy();data.totalElementsNumber=sets[_currentSet].length;if(number===_total ) {this.navigationGoToElement(number-1);}else{this.navigationGoToElement(number);}}},replaceHtmlPatterns:function(htmlString,patterns ) {$.each(patterns,function(key,value) {var _regExp=new RegExp("{" +key+ "}","g");htmlString=htmlString.replace(_regExp,value);});return htmlString;},setButtonState:function(state,jqElement) {var $lb=this.$lightbox,jqElem=jqElement||$lb.controlButtons;switch(state) {case"default":jqElem.removeClass("ui-state-highlight ui-state-disabled");break;case"highlight":jqElem.addClass( "ui-state-highlight" );break;case"disabled":jqElem.addClass( "ui-state-disabled" );break;}},setCursor:function(event) {var data=this.data,$lb=this.$lightbox,$contentContainer=$lb.contentContainer,_currentSet=data.currentSet,_currentSetElement=data.currentSetElement,_setElementType=data.currentSetElement.type,_totalElements=data.totalElementsNumber,_currentElement=data.currentElementNumber,_side=data.side,_panoramaEnabled=data.panoramaOn,_isError=data.showErrorMessage,_options=_currentSetElement.self.options,_isLoop=_options.loop;if(data.ready ) {if( (_currentSet==="single"||_totalElements===1||_currentElement===1&&_side=== "left"||_currentElement===_totalElements&&_side==="right")&&_panoramaEnabled===false&&(_setElementType==="image"||(_setElementType!=="image"&& _isError))) {if( _isLoop===false) {$contentContainer.css( "cursor","default");}else{$contentContainer.css( "cursor","pointer");}}else if(_panoramaEnabled) {$contentContainer.css( "cursor","move");}else if(_setElementType==="image"|| (_setElementType!=="image" && _isError)){$contentContainer.css( "cursor","pointer");}else{$contentContainer.css( "cursor","auto");}}else{$contentContainer.css( "cursor","default");}
if(event) {event.preventDefault();}},setNextQueue:function(){var $lb=this.$lightbox,queueList=[$.proxy(this.queueSlideUpHeader,this),$.proxy(this.queueHideContent,this),$.proxy(this.queueLoadContent,this),$.proxy(this.queueResizeLightbox,this),$.proxy(this.queueCenterContent,this),$.proxy(this.queueShowContent,this),$.proxy(this.queueSlideDownHeader,this)];$lb.queueContainer.next.queue("lightboxNext",queueList);},setOpenQueue:function(){var $lb=this.$lightbox,queueList=[$.proxy(this.queueShowOverlay,this),$.proxy(this.queueCenterLightbox,this),$.proxy(this.queueLoadContent,this),$.proxy(this.queueResizeLightbox,this),$.proxy(this.queueCenterContent,this),$.proxy(this.queueShowContent,this),$.proxy(this.queueSlideDownHeader,this)];$lb.queueContainer.open.queue("lightboxOpen",queueList);},setReferences:function(){var $lb=this.$lightbox;$lb.root=$("#ui-lightbox");$lb.panoramaIcon=$lb.root.find("#ui-lightbox-panorama-icon");$lb.contentContainer=$lb.root.find("#ui-lightbox-content-container");$lb.content=$lb.contentContainer.find("#ui-lightbox-content");$lb.arrow=$lb.contentContainer.find( "#ui-lightbox-arrow");$lb.header=$lb.root.find("#ui-lightbox-bottombar");$lb.headerWrapper=$lb.header.find( "#ui-lightbox-title-wrapper" );$lb.overlay=$("#ui-lightbox-overlay");$lb.next=$lb.root.find("#ui-lightbox-button-next");$lb.prev=$lb.root.find( "#ui-lightbox-button-prev");$lb.controlButtons=$lb.next.add($lb.prev);$lb.close=$lb.root.find("#ui-lightbox-button-close");$lb.counter=$lb.root.find("#ui-lightbox-counter");$lb.title=$lb.root.find("#ui-lightbox-title");$lb.map=$("#ui-lightbox-map");$lb.viewport=$lb.map.children().eq(0);$lb.queueContainer={open:$({}),next:$({})};},showArrow:function(event){var data=this.data,$lb=this.$lightbox,$arrow=$lb.arrow,_isError=data.showErrorMessage,_side=data.side,_currentElement=data.currentElementNumber,_totalElements=data.totalElementsNumber,_isLoop=data.currentSetElement.self.options.loop;if(data.ready&&data.currentSet!=="single"&&(data.currentSetElement.type==="image"||_isError)&&data.panoramaOn===false){if(_side==="left"&&(_currentElement>1||_isLoop)){$arrow.show().removeClass("ui-lightbox-arrow-next ui-corner-left").addClass("ui-lightbox-arrow-prev ui-corner-right").find("span").removeClass("ui-icon-carat-1-e").addClass("ui-icon-carat-1-w");}else if(_side==="right"&&(_currentElement<_totalElements||_isLoop)){$arrow.show().removeClass("ui-lightbox-arrow-prev ui-corner-right").addClass("ui-lightbox-arrow-next ui-corner-left").find("span").removeClass("ui-icon-carat-1-w").addClass("ui-icon-carat-1-e");}else{this.hideArrow();}}
if(event) {event.preventDefault();}},showErrorMessage:function() {var $again,$reject,$structure,data=this.data,$lb=this.$lightbox,self=this,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_currentElementNumber=data.currentElementNumber,_errorMessage=_options.errorMessage,_againLabel=_options.againButtonLabel,_rejectLabel=_options.rejectButtonLabel,_structure=data.htmlErrorScreen,_errorScreenSize=data.errorScreenSize,_errorScreenWidth=_errorScreenSize.width,_errorScreenHeight=_errorScreenSize.height;_structure=self.replaceHtmlPatterns(_structure,{message:_errorMessage,labelAgain:_againLabel,labelReject:_rejectLabel});$structure=$( _structure );$again=$structure.find("#ui-lightbox-error-footer-again");$reject=$structure.find( "#ui-lightbox-error-footer-reject" );$again.click(function() {self.navigationGoToElement( _currentElementNumber);}).hover(function() {$(this).toggleClass( "ui-state-hover" );});$reject.click(function() {self.removeSetElement( _currentElementNumber );}).hover(function() {$(this).toggleClass( "ui-state-hover" );});$lb.content.empty().append($structure ).find( "#ui-lightbox-error" ).width( _errorScreenWidth).height( _errorScreenHeight).end().children().hide();data.showErrorMessage=true;},updateCounter:function(){var _current,_total,_newCounter,data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_currentSet=data.currentSet;if(_currentSet!=="single"){_current=data.currentElementNumber;_total=data.totalElementsNumber;}else{_current=1;_total=1;}
_newCounter=_current+_options.counterDelimiter+_total;$lb.counter.text(_newCounter);},updateTitle:function(){var data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement;if(_currentElement.title!==""){$lb.title.empty().append(_currentElement.title);}else{$lb.title.append("&nbsp;");}},updateTitleWidth:function() {var $lb=this.$lightbox;$lb.header.width($lb.content.width()-12);},queueHideContent:function(next){var data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_options=_currentElement.self.options;$lb.content.children().fadeOut(_options.animationSpeed,function(){$(this).remove();next();});$lb.panoramaIcon.hide().removeClass("ui-lightbox-panorama-icon-expand ui-lightbox-panorama-icon-shrink");data.panoramaOn=false;this.panoramaHideMap();},queueShowOverlay:function(next){var data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement.self;data.ready=false;this.setCursor();$lb.overlay.fadeIn(_currentElement.options.animationSpeed,next);},queueCenterLightbox:function(next){var $lb=this.$lightbox,$root=$lb.root,_screenWidth=this.getWindowSize( "width" ),_screenHeight=this.getWindowSize( "height" ),_lbWidth=$root.outerWidth(),_lbHeight=$root.outerHeight();$root.css({left:Math.round((_screenWidth-_lbWidth)/2)+"px",top:Math.round((_screenHeight-_lbHeight)/2)+"px"}).show(0,next);},queueLoadContent:function(next){var _loadContentMethod,data=this.data,_currentSetElement=data.currentSetElement;data.showErrorMessage=false;switch(_currentSetElement.type){case"image":_loadContentMethod="loadContentImage";break;case"youtube":_loadContentMethod="loadContentYoutube";break;case"vimeo":_loadContentMethod="loadContentVimeo";break;case"flash":_loadContentMethod= "loadContentFlash";}
$.when(this[_loadContentMethod](_currentSetElement.url)).then(function() {next();});},queueResizeLightbox:function(next){var _speed,_animate,_sizes,_imageTargetWidth,_imageTargetHeight,_lightboxTargetWidth,_lightboxTargetHeight,_img,data=this.data,$lb=this.$lightbox,_padding=data.lightboxPadding,_headerHeight=data.headerHeight,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_isError=data.showErrorMessage,_errorScreenSize=data.errorScreenSize,_errorScreenWidth=_errorScreenSize.width,_errorScreenHeight=_errorScreenSize.height,_minimalLightboxSize=data.minimalLightboxSize,_minimalLightboxWidth=_minimalLightboxSize.width,_minimalLightboxHeight=_minimalLightboxSize.height;_speed=_options.animationSpeed;if(_currentElement.type==="image"&& _isError===false) {_sizes=this.getSizes();_imageTargetWidth=_sizes.imageTargetWidth;_imageTargetHeight=_sizes.imageTargetHeight;_lightboxTargetWidth=_sizes.lightboxTargetWidth;_lightboxTargetHeight=_sizes.lightboxTargetHeight;_img=$lb.content.find("img");_currentElement.currentWidth=_imageTargetWidth;_currentElement.currentHeight=_imageTargetHeight;_img.width(_imageTargetWidth).height(_imageTargetHeight);if($.isFunction(next)){_speed=_options.animationSpeed;}else{_speed=0;}}else if((_currentElement.type==="youtube"||_currentElement.type==="vimeo") &&_isError===false){_lightboxTargetWidth=this.checkMinimalSize("width",_currentElement.width );_lightboxTargetHeight=this.checkMinimalSize( "height",_currentElement.height );}else if(_currentElement.type==="flash"&& _isError===false) {_lightboxTargetWidth=this.getOptimalSize("width",_currentElement.width);_lightboxTargetHeight=this.getOptimalSize( "height",_currentElement.height );}else if(_isError){_speed=0;_lightboxTargetWidth=_errorScreenWidth;_lightboxTargetHeight=_errorScreenHeight;}
$lb.root.find("#ui-lightbox-content").animate({width:_lightboxTargetWidth},_speed).animate({height:_lightboxTargetHeight},_speed).end().animate({left:(this.getWindowSize("width")-_lightboxTargetWidth-_padding)/2},_speed).animate({top:(this.getWindowSize("height")-_lightboxTargetHeight-_padding-_headerHeight)/2},_speed,next);},queueCenterContent:function(next){var _content,$lb=this.$lightbox,$contentContainer=$lb.content,$content=$contentContainer.children();$contentContainer.children().css({top:$contentContainer.height()/2-$content.outerHeight()/2,left:$contentContainer.width()/2-$content.outerWidth()/2});if(next){next();}},queueShowContent:function(next){var data=this.data,$lb=this.$lightbox,self=this,_currentElement=data.currentSetElement,_options=_currentElement.self.options,_isError=data.showErrorMessage;$lb.content.children().fadeIn(_options.animationSpeed,function(){if(_currentElement.type==="image"&&_isError===false) {self.panoramaCheckAvailability();}
next();});},queueSlideDownHeader:function(next){var data=this.data,$lb=this.$lightbox,_options=data.currentSetElement.self.options;$lb.header.slideDown(_options.animationSpeed,next);this.updateCounter();this.updateTitleWidth();this.updateTitle();this.checkButtonsState();data.ready=true;this.setCursor();this.showArrow();},queueSlideUpHeader:function(next){var data=this.data,$lb=this.$lightbox,_currentElement=data.currentSetElement,_options=_currentElement.self.options;data.ready=false;this.hideArrow();this.setCursor();$lb.header.slideUp(_options.animationSpeed,next);},$lightbox:{},sets:{},data:{minimalLightboxSize:{width:300,height:300},lightboxPadding:12,headerHeight:57,ready:false,panoramaOn:false,mapSize:{width:150,height:100},providers:{vimeo:"http://www.vimeo.com/api/oembed.json?callback=?",youtube:"http://gdata.youtube.com/feeds/api/videos/"},showErrorMessage:false,currentSetElement: {},enablePanorama:false,errorScreenSize:{width:500,height:500},htmlFlash:""+"<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' width='{width}' height='{height}'>"+"<param name='movie' value='{url}' />"+"<!--[if !IE]>-->"+"<object type='application/x-shockwave-flash' data='{url}' width='{width}' height='{height}'>" +"<!--<![endif]-->" +"<!--[if !IE]>-->"+"</object>" +"<!--<![endif]-->"+"</object>",htmlErrorScreen:""+"<div id='ui-lightbox-error'>"+"<div id='ui-lightbox-error-message' class='ui-lightbox-error-icon-sign'>{message}</div>"+"<div id='ui-lightbox-error-footer'>"+"<button aria-disabled='false' role='button' id='ui-lightbox-error-footer-again' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary'>" +"<span class='ui-button-icon-primary ui-icon ui-icon-refresh'></span>"+"<span class='ui-button-text'>{labelAgain}</span>"+"</button>"+"<button aria-disabled='false' role='button' id='ui-lightbox-error-footer-reject' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary'>" +"<span class='ui-button-icon-primary ui-icon ui-icon-trash'></span>"+"<span class='ui-button-text'>{labelReject}</span>"+"</button>"+"</div>"+"</div>",htmlYoutube:"<iframe class='youtube-player' type='text/html' width='{width}' height='{height}' src='http://www.youtube.com/embed/{url}' frameborder='0'></iframe>",htmlLightbox:""+"<div id='ui-lightbox' class='ui-widget ui-widget-content ui-corner-all' style='display: none'>" +"<div id='ui-lightbox-content-container'>"+"<div id='ui-lightbox-content' class='ui-widget-content'></div>"+"<a id='ui-lightbox-arrow' class='ui-widget-header' style='display: none'>"+"<span class='ui-icon'>go</span>"+"</a>"+"</div>"+"<div id='ui-lightbox-bottombar' class='ui-widget-header ui-corner-all' style='display: none'>"+"<p id='ui-lightbox-title-wrapper'>"+"<span id='ui-lightbox-title'></span>"+"</p>"+"<p id='ui-lightbox-bottombar-bottom'>"+"<a id='ui-lightbox-button-prev' class='ui-lightbox-button'>"+"<span class='ui-icon ui-icon-circle-arrow-w'>prev</span>"+"</a>"+"<span id='ui-lightbox-counter'></span>"+"<a id='ui-lightbox-button-next' class='ui-lightbox-button'>"+"<span class='ui-icon ui-icon-circle-arrow-e'>next</span>"+"</a>"+"</p>"+"<a id='ui-lightbox-button-close' class='ui-lightbox-button'>"+"<span class='ui-icon ui-icon-closethick'>close</span>"+"</a>"+"<div id='ui-lightbox-panorama-icon' style='display: none'></div>" +"</div>"+"</div>",htmlMap:""+"<div id='ui-lightbox-map' style='display: none'>"+"<div id='ui-lightbox-map-viewport'></div>"+"</div>",htmlOverlay:"<div id='ui-lightbox-overlay' class='ui-widget-overlay' style='display: none'></div>"}}});})(jQuery);